<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>For Ipsita ‚ù§Ô∏è</title>

<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@500;700&display=swap" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

<style>
*{box-sizing:border-box;}
body{
  margin:0;
  background:radial-gradient(circle at top,#1a1a1a,#000 70%);
  font-family:'Playfair Display',serif;
  color:white;
  text-align:center;
  overflow:hidden;
}

/* Countdown */
#countdownScreen, #birthdayScreen{
  position:absolute;
  width:100%;height:100%;
  display:flex;
  flex-direction:column;
  justify-content:center;
  align-items:center;
  padding:20px;
}
#birthdayScreen{display:none;overflow-y:auto;}
.glow-img{width:min(70%,280px);border-radius:20px;box-shadow:0 0 40px rgba(212,175,55,.7);}
#countdownTimer{font-size:32px;color:#d4af37;font-family:monospace;margin-top:15px;}

.gold{color:#d4af37;}
button{
  padding:14px 20px;
  border-radius:40px;
  border:2px solid #d4af37;
  background:rgba(0,0,0,.4);
  color:#d4af37;
  font-weight:bold;
  margin:10px;
  cursor:pointer;
}

/* Cake */
.cake{position:relative;width:200px;height:230px;margin-top:20px;}
.cake-base{
  position:absolute;bottom:0;width:100%;height:100px;
  background:linear-gradient(#ffb6c1,#ff8fab);
  border-radius:20px;
}
.candle{
  position:absolute;width:12px;height:60px;background:white;
  left:50%;transform:translateX(-50%);
  bottom:100px;
}
.flame{
  position:absolute;width:18px;height:26px;
  left:50%;transform:translateX(-50%);
  bottom:160px;
  background:radial-gradient(circle,#ffd700 40%,orange 70%);
  border-radius:50%;
  transition:transform .1s;
}

/* Smoke */
.smoke{
  position:absolute;
  width:12px;height:12px;
  background:rgba(200,200,200,.7);
  border-radius:50%;
  bottom:170px;
  left:50%;
  transform:translateX(-50%);
  animation:smokeRise 3s ease-out forwards;
}
@keyframes smokeRise{
  from{opacity:.8;transform:translate(-50%,0) scale(1);}
  to{opacity:0;transform:translate(-50%,-80px) scale(2);}
}

/* Confetti canvas */
canvas{
  position:fixed;
  top:0;left:0;
  pointer-events:none;
}
.message{opacity:0;transition:opacity 2s;}
.show{opacity:1;}
</style>
</head>

<body>

<div id="countdownScreen">
  <h1>Something beautiful is coming ‚ú®</h1>
  <img src="ipsita.jpeg" class="glow-img">
  <div id="countdownTimer"></div>
</div>

<div id="birthdayScreen">
  <h1>Happy <span class="gold">30th</span> Birthday ‚ù§Ô∏è</h1>

  <div class="cake">
    <div class="cake-base"></div>
    <div class="candle"></div>
    <div class="flame" id="flame"></div>
  </div>

  <button id="blowBtn" onclick="startMicBlow()">Blow the Candle üé§üéÇ</button>
  <button id="retryBtn" style="display:none;" onclick="retryBlow()">Try Again üîÅ</button>

  <div class="message" id="message">
    With all my love ‚Äî Khalikul ‚ù§Ô∏è
  </div>
</div>

<canvas id="confetti"></canvas>

<script>
/* ================= COUNTDOWN ================= */
const TARGET_OFFSET=5.5*60*60*1000;
function getTarget(year){return Date.UTC(year,2,2)-TARGET_OFFSET;}
let now=Date.now();
let year=new Date(now+TARGET_OFFSET).getUTCFullYear();
let target=getTarget(year);
if(now>=target){year++;target=getTarget(year);}

function updateCountdown(){
  let diff=target-Date.now();
  if(diff<=0){
    countdownScreen.style.display="none";
    birthdayScreen.style.display="flex";
    return;
  }
  let d=Math.floor(diff/86400000);
  let h=Math.floor((diff%86400000)/3600000);
  let m=Math.floor((diff%3600000)/60000);
  let s=Math.floor((diff%60000)/1000);
  countdownTimer.innerHTML=`${d}d ${h}h ${m}m ${s}s`;
}
setInterval(updateCountdown,1000);

/* ================= MIC + FLAME ================= */
let audioCtx, analyser, source, data;
let blowTimer=null;
let blown=false;

async function startMicBlow(){
  blowBtn.innerText="Blow now... üí®";
  retryBtn.style.display="none";
  blown=false;

  const stream=await navigator.mediaDevices.getUserMedia({audio:true});
  audioCtx=new (window.AudioContext||window.webkitAudioContext)();
  analyser=audioCtx.createAnalyser();
  source=audioCtx.createMediaStreamSource(stream);
  source.connect(analyser);
  analyser.fftSize=256;
  data=new Uint8Array(analyser.frequencyBinCount);

  detectBlow();
  blowTimer=setTimeout(()=>{
    if(!blown){
      stopMic();
      blowBtn.innerText="Too soft üòÖ";
      retryBtn.style.display="inline-block";
    }
  },5000);
}

function detectBlow(){
  analyser.getByteFrequencyData(data);
  let volume=data.reduce((a,b)=>a+b)/data.length;

  // Flame reacts to volume
  flame.style.transform=`translateX(-50%) scale(${1+volume/200})`;

  if(volume>60){
    blown=true;
    clearTimeout(blowTimer);
    extinguish();
    stopMic();
    return;
  }
  if(!blown) requestAnimationFrame(detectBlow);
}

function stopMic(){
  if(source) source.disconnect();
  if(audioCtx) audioCtx.close();
}

function retryBlow(){
  blowBtn.innerText="Blow the Candle üé§üéÇ";
  retryBtn.style.display="none";
}

/* ================= EXTINGUISH ================= */
function extinguish(){
  flame.style.display="none";
  createSmoke();
  startConfetti();
  message.classList.add("show");
}

function createSmoke(){
  for(let i=0;i<5;i++){
    let s=document.createElement("div");
    s.className="smoke";
    s.style.left="50%";
    s.style.animationDelay=i*0.3+"s";
    document.querySelector(".cake").appendChild(s);
    setTimeout(()=>s.remove(),3000);
  }
}

/* ================= CONFETTI PHYSICS ================= */
const canvas=document.getElementById("confetti");
const ctx=canvas.getContext("2d");
canvas.width=window.innerWidth;
canvas.height=window.innerHeight;

let confetti=[];

function startConfetti(){
  for(let i=0;i<150;i++){
    confetti.push({
      x:canvas.width/2,
      y:canvas.height/2,
      vx:(Math.random()-0.5)*8,
      vy:(Math.random()-0.5)*8,
      size:Math.random()*6+4,
      color:`hsl(${Math.random()*360},100%,50%)`,
      gravity:0.15,
      life:200
    });
  }
  animateConfetti();
}

function animateConfetti(){
  ctx.clearRect(0,0,canvas.width,canvas.height);
  for(let i=confetti.length-1;i>=0;i--){
    let c=confetti[i];
    c.vy+=c.gravity;
    c.x+=c.vx;
    c.y+=c.vy;
    c.life--;
    ctx.fillStyle=c.color;
    ctx.fillRect(c.x,c.y,c.size,c.size);
    if(c.life<=0) confetti.splice(i,1);
  }
  if(confetti.length>0) requestAnimationFrame(animateConfetti);
}
</script>

</body>
</html>
